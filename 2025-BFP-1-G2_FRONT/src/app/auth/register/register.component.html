<div class="register-container">
  <mat-card class="register-card">
    <mat-horizontal-stepper [linear]="true" #stepper>
      <mat-step [stepControl]="registerForm">
        <form [formGroup]="registerForm">
          <mat-card class="formdata">
            <h2 #formTitle>Registrarse</h2>

            <div class="form-grid">
              <mat-form-field appearance="outline" class="decorated-field">
                <mat-label>Nombre de usuario</mat-label>
                <input matInput placeholder="usuario123" [formControl]="login" required>
                <mat-icon matPrefix class="field-icon">person</mat-icon>
                <mat-error *ngIf="login.invalid">{{ getLoginErrorMessage() }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="decorated-field">
                <mat-label>Nombre</mat-label>
                <input matInput placeholder="Nombre" [formControl]="name" required>
                <mat-icon matPrefix class="field-icon">badge</mat-icon>
                <mat-error *ngIf="name.invalid">{{ getNameErrorMessage() }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="decorated-field">
                <mat-label>Primer apellido</mat-label>
                <input matInput placeholder="Apellido 1" [formControl]="surname1" required>
                <mat-icon matPrefix class="field-icon">family_restroom</mat-icon>
                <mat-error *ngIf="surname1.invalid">{{ getSurname1ErrorMessage() }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="decorated-field">
                <mat-label>Segundo apellido</mat-label>
                <input matInput placeholder="Apellido 2" [formControl]="surname2" required>
                <mat-icon matPrefix class="field-icon">family_restroom</mat-icon>
                <mat-error *ngIf="surname2.invalid">{{ getSurname2ErrorMessage() }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="decorated-field">
                <mat-label>Email</mat-label>
                <input matInput placeholder="correo@dominio.es" [formControl]="email" required>
                <mat-icon matPrefix class="field-icon">email</mat-icon>
                <mat-error *ngIf="email.invalid">{{ getEmailErrorMessage() }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="decorated-field">
                <mat-label>Teléfono</mat-label>
                <input matInput placeholder="123456789" [formControl]="phoneNumber" required>
                <mat-icon matPrefix class="field-icon">phone</mat-icon>
                <mat-error *ngIf="phoneNumber.invalid">{{ getPhoneNumberErrorMessage() }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="decorated-field">
                <mat-label>Contraseña</mat-label>
                <input matInput type="password" placeholder="Contraseña" [formControl]="password" required>
                <mat-icon matPrefix class="field-icon">lock</mat-icon>
                <mat-error *ngIf="password.invalid">{{ getPasswordErrorMessage() }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="decorated-field">
                <mat-label>Confirma la contraseña</mat-label>
                <input matInput type="password" placeholder="Confirmar contraseña" [formControl]="confirmPassword"
                  required>
                <mat-icon matPrefix class="field-icon">lock_outline</mat-icon>
                <mat-error *ngIf="confirmPassword.invalid || password.value !== confirmPassword.value">
                  {{ getConfirmPasswordErrorMessage() }}
                </mat-error>
              </mat-form-field>
            </div>
          </mat-card>
        </form>
      </mat-step>

      <mat-step [stepControl]="thirdFormGroup">
        <form [formGroup]="thirdFormGroup">
          <mat-card class="formdata">
            <h2>Áreas de interés</h2>
            <p class="tags-subtitle">Selecciona hasta 10 áreas que te interesen (opcional).</p>
            <div class="selected-tags-count" *ngIf="availableTags.length > 0">
              Áreas seleccionadas: {{getSelectedTagsCount()}} / 10
            </div>
            <div class="tags-container" *ngIf="availableTags.length > 0">
              <mat-chip-listbox class="tags-listbox" multiple [formControl]="getTagsFormControl()">
                <mat-chip-option *ngFor="let tag of availableTags" [value]="tag"
                  [class.chip-selected]="isTagSelected(tag)"
                  [class.chip-unselected]="!isTagSelected(tag)"
                  [disabled]="getSelectedTagsCount() >= 10 && !isTagSelected(tag)">
                  {{tag.name}}
                </mat-chip-option>
              </mat-chip-listbox>
            </div>

            <div *ngIf="availableTags.length === 0" class="loading-tags">
              <p>Cargando áreas de interés...</p>
            </div>
          </mat-card>
        </form>
      </mat-step>
    </mat-horizontal-stepper>
    <mat-card-footer>
      <div class="external-form-actions">
        <div class="step-buttons" *ngIf="stepper.selectedIndex === 0">
          <button mat-raised-button color="primary" [disabled]="!isStep1Valid()" (click)="registerBasicInfo()">
            Finalizar registro
          </button>
          <button mat-raised-button color="accent" [disabled]="!isStep1Valid()" (click)="nextStep()">
            Completar datos
          </button>
          <button class="home-button" mat-raised-button color="primary" type="button" (click)="goHome()">
            <mat-icon>home</mat-icon>
          </button>
        </div>

        <div class="step-buttons" *ngIf="stepper.selectedIndex === 1">
          <button mat-raised-button color="primary" (click)="nextStep()">
            Continuar
          </button>
          <button mat-raised-button color="basic" (click)="previousStep()">
            Volver
          </button>
        </div>

        <div class="step-buttons" *ngIf="stepper.selectedIndex === 2">
          <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" [disabled]="!formValid()">
            Finalizar Registro
          </button>
          <button mat-raised-button color="accent" (click)="previousStep()">Volver</button>
          <button class="home-button" mat-raised-button color="primary" type="button" (click)="goHome()">
            <mat-icon>home</mat-icon>
          </button>
        </div>
      </div>
    </mat-card-footer>

  </mat-card>
  <div class="step-footer">
    <p>¿Ya tienes una cuenta?</p>
    <button mat-raised-button color="primary" routerLink="../login" class="login-link">Inicia sesión</button>
  </div>

</div>