<div class="offers-container">
  <div class="offers-header">
    <h2 class="page-title">
      <mat-icon>work</mat-icon>
      Ofertas
    </h2>
    <div class="filter-chips" *ngIf="availableTags.length > 0">
      <mat-label class="filter-label">Filtrar por áreas:</mat-label>
      <mat-chip-listbox multiple [formControl]="tagsFilterControl" (change)="filterOffers()"> <mat-chip-option
          *ngFor="let tag of availableTags" [value]="tag">
          {{tag.name}}
        </mat-chip-option>
      </mat-chip-listbox>
    </div>
    <div class="search-container">
      <div class="search-and-selectors">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar ofertas</mat-label>
          <input matInput placeholder="Oferta, ubicación, empresa..." [(ngModel)]="searchTerm" (input)="filterOffers()">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <div class="offer-selectors" *ngIf="isCandidate">
          <button mat-raised-button [color]="currentOfferView === 'recommended' ? 'primary' : ''"
            class="selector-button" (click)="setOfferView('recommended')" matBadge="{{ getRecommendedOffersCount() }}"
            matBadgePosition="after" matBadgeSize="small" [matBadgeHidden]="getRecommendedOffersCount() === 0">
            <mat-icon>star</mat-icon>
            Recomendadas
          </button>

          <button mat-raised-button [color]="currentOfferView === 'applied' ? 'primary' : ''" class="selector-button"
            (click)="setOfferView('applied')" matBadge="{{ getAppliedOffersCount() }}" matBadgePosition="after"
            matBadgeSize="small" [matBadgeHidden]="getAppliedOffersCount() === 0">
            <mat-icon>assignment_turned_in</mat-icon>
            Aplicadas
          </button>

          <button mat-raised-button [color]="currentOfferView === 'bookmarks' ? 'primary' : ''" class="selector-button"
            (click)="setOfferView('bookmarks')" matBadge="{{ getBookmarkedOffersCount() }}" matBadgePosition="after"
            matBadgeSize="small" [matBadgeHidden]="getBookmarkedOffersCount() === 0">
            <mat-icon>bookmark</mat-icon>
            Guardadas
          </button>

          <button mat-raised-button [color]="currentOfferView === 'all' ? 'primary' : ''" class="selector-button"
            (click)="setOfferView('all')">
            <mat-icon>list</mat-icon>
            Todas
          </button>
        </div>
      </div>
    </div>
  </div>

  <mat-divider></mat-divider>
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando ofertas...</p>
  </div>
  <div class="grid-container" *ngIf="!isLoading">
    <app-offer-card
      *ngFor="let offer of filterOffers(); let i = index"
      [offer]="offer"
      [isBookmarked]="isBookmarked(offer.id)"
      (click)="openDetailedCard(i)"
      (viewDetails)="onViewDetails($event)"
      (toggleBookmark)="toggleBookmark($event)"
    >
    </app-offer-card>
  </div>

  <app-detailed-card [isVisible]="showDetailedCard" [data]="detailedCardData" [currentIndex]="currentDetailIndex"
    [showNavigation]="true" [cardType]="'offer'" [availableTags]="availableTags" (onClose)="closeDetailedCard()"
    (onAction)="onDetailedCardAction($event)" (onSave)="onDetailedCardSave($event)">
  </app-detailed-card>

</div>