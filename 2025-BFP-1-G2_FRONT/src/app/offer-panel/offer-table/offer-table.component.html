<div class="offers-container">
  <div class="offers-header">
    <h2 class="page-title">
      <mat-icon>work</mat-icon>
      Ofertas
    </h2>
    <div class="filter-chips" *ngIf="availableTags.length > 0">
      <mat-label class="filter-label">Filtrar por áreas:</mat-label>
      <mat-chip-listbox multiple [formControl]="tagsFilterControl" (change)="offers"> <mat-chip-option
          *ngFor="let tag of availableTags" [value]="tag">
          {{tag.name}}
        </mat-chip-option>
      </mat-chip-listbox>
    </div>
    <div class="search-container">
      <div class="search-and-selectors">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar ofertas</mat-label>
          <input matInput placeholder="Oferta, ubicación, empresa..." [(ngModel)]="searchTerm" (input)="offers"
            (ngModelChange)="lastSearchTerm = ''">
          <button mat-icon-button *ngIf="searchTerm" matSuffix (click)="loadCandidateOffers(); searchTerm = ''">
            <mat-icon>close</mat-icon>
          </button>
          <button mat-icon-button matSuffix (click)="loadCandidateOffersBySearchTerm()">
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>

        <div class="offer-selectors" *ngIf="isCandidate">
          <button mat-raised-button [color]="currentOfferView === 'recommended' ? 'primary' : ''" class="selector-button" 
            (click)="setOfferView('recommended')" matBadge="{{ recomendedOfferCount }}" matBadgePosition="after" 
            matBadgeSize="small" [matBadgeHidden]="recomendedOfferCount === 0">
            <mat-icon>star</mat-icon>
            Recomendadas
          </button>

          <button mat-raised-button [color]="currentOfferView === 'applied' ? 'primary' : ''" class="selector-button"
            (click)="setOfferView('applied')" matBadge="{{ appliedOfferCount }}" matBadgePosition="after"
            matBadgeSize="small" [matBadgeHidden]="appliedOfferCount === 0">
            <mat-icon>assignment_turned_in</mat-icon>
            Aplicadas
          </button>

          <button mat-raised-button [color]="currentOfferView === 'bookmarks' ? 'primary' : ''" class="selector-button"
            (click)="setOfferView('bookmarks')" matBadge="{{ bookmarkedOfferCount }}" matBadgePosition="after"
            matBadgeSize="small" [matBadgeHidden]="bookmarkedOfferCount === 0">
            <mat-icon>bookmark</mat-icon>
            Guardadas
          </button>

          <button mat-raised-button [color]="currentOfferView === 'all' ? 'primary' : ''" class="selector-button"
            (click)="setOfferView('all')" matBadge="{{ activeOfferCount }}" matBadgePosition="after"
            matBadgeSize="small" [matBadgeHidden]="activeOfferCount === 0">
            <mat-icon>list</mat-icon>
            Todas
          </button>
        </div>

        <div class="offer-selectors" *ngIf="isCompany">
          <button mat-raised-button [color]="currentOfferStatus === 'active' ? 'primary' : ''" class="selector-button"
            (click)="setOfferStatus('active')" matBadge="{{ getActiveOffersCount() }}" matBadgePosition="after"
            matBadgeSize="small" [matBadgeHidden]="getActiveOffersCount() === 0"
            [class.selected]="currentOfferStatus === 'active'">
            <mat-icon>visibility</mat-icon>
            Activas
          </button>

          <button mat-raised-button [color]="currentOfferStatus === 'draft' ? 'primary' : ''" class="selector-button"
            (click)="setOfferStatus('draft')" matBadge="{{ getDraftOffersCount() }}" matBadgePosition="after"
            matBadgeSize="small" [matBadgeHidden]="getDraftOffersCount() === 0"
            [class.selected]="currentOfferStatus === 'draft'">
            <mat-icon>edit</mat-icon>
            Borradores
          </button>

          <button mat-raised-button [color]="currentOfferStatus === 'archived' ? 'primary' : ''" class="selector-button"
            (click)="setOfferStatus('archived')" matBadge="{{ getArchivedOffersCount() }}" matBadgePosition="after"
            matBadgeSize="small" [matBadgeHidden]="getArchivedOffersCount() === 0"
            [class.selected]="currentOfferStatus === 'archived'">
            <mat-icon>archive</mat-icon>
            Archivadas
          </button>
        </div>
      </div>
    </div>
  </div>

  <mat-divider></mat-divider>
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner color="primary" diameter="50"></mat-spinner>
    <p>Cargando ofertas...</p>
  </div>
  <div class="grid-container" *ngIf="!isLoading">
    <app-offer-card *ngFor="let offer of offers; let i = index" [offer]="offer" [isCompany]="isCompany"
      [isCandidate]="isCandidate" [isBookmarked]="isBookmarked(offer.id!)" (click)="openDetailedCard(i)"
      (viewDetails)="onViewDetails($event)" (toggleBookmark)="toggleBookmark($event)">
    </app-offer-card>
  </div>

  <app-detailed-card [isVisible]="showDetailedCard" [data]="detailedCardData" [currentIndex]="currentDetailIndex"
    [showNavigation]="true" [cardType]="'offer'" [availableTags]="availableTags" (onClose)="closeDetailedCard()"
    (onAction)="onDetailedCardAction($event)" (onSave)="onDetailedCardSave($event)">
  </app-detailed-card>

</div>